{"version":3,"file":"ng-input-highlighter.js.map","sources":["ng://ng-input-highlighter/lib/ng-input-highlighter.service.ts","ng://ng-input-highlighter/lib/ng-input-highlighter.component.ts","ng://ng-input-highlighter/lib/ng-input-highlighter.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgInputHighlighterService {\n\n  constructor() { }\n}\n","import {\n  Component,\n  OnInit,\n  ViewChild, Renderer2, ElementRef, AfterViewInit, Input, OnChanges, SimpleChanges, Output, EventEmitter } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { TargetArrayItem } from './classes/targetTextItem.class';\nimport { TargetItem } from './classes/targetItems.class';\n\n@Component({\n  selector: 'lib-ng-input-highlighter',\n  templateUrl: './ng-input-highlighter.html',\n  styleUrls: ['./ng-input-highlighter.css']\n})\n\nexport class NgInputHighlighterComponent implements OnInit, OnChanges, AfterViewInit {\n\n  @Input() regularClass = 'regularText' // optional class for input of style for regular text in box\n  @Input() targetItems: Array<TargetItem> = []; // analysis inside component: array of items to find\n  @Input() localAnalysis = true\n  @Input() caseSensitive = false; // allow for option to select case sensitivity- default to off\n  @Output() currentText = new EventEmitter<string>(); // current text string, will output for analysis or other work outside\n\n  @ViewChild('lastInput') lastInput: ElementRef;\n  @ViewChild('inputBox') inputBox: ElementRef;\n\n  private textSubject: Subject<string> = new Subject()\n  public responsePending = false\n  public textArray: Array<TargetArrayItem> = []\n  public textHTMLstring: string\n  public tempString = ''\n\n  constructor(private renderer: Renderer2) {\n  }\n\n  ngOnInit() {\n  // Timer to check when to send request to text analysis\n    this.textSubject.pipe(\n      debounceTime(2000)\n    ).subscribe(text => {\n      console.log(text);\n      this.responsePending = true;\n      this.currentText.emit(this.tempString);\n      // If we're doing local analysis, begin the process, otherwise- wait for response from service\n      if (this.localAnalysis) {\n        this.constructLocally()\n        setTimeout(() => {\n          this.responsePending = false\n          this.focusInput()\n        }, 500)\n      }\n    })\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if ((this.targetItems.length > 0) && (!this.localAnalysis)) {\n      if (changes.targetItems) {\n        this.constructExternally()\n        setTimeout(() => {\n          this.responsePending = false\n          this.focusInput()\n        }, 500)\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    // Add event listeners to the DOM elements after rendered, allowing for box-border\n    this.renderer.listen(this.lastInput.nativeElement, 'focus', () => {\n      this.renderer.addClass(this.inputBox.nativeElement, 'focused');\n    });\n    this.renderer.listen(this.lastInput.nativeElement, 'blur', () => {\n      this.renderer.removeClass(this.inputBox.nativeElement, 'focused');\n    });\n    // Focus the caret at the end of the box\n    this.focusInput();\n    console.log('targetItems', this.targetItems);\n  }\n  // Method called upon a keystroke to begin the process of waiting for a 2 second pause in keystrokes\n  textChange(e) {\n    this.tempString = e;\n    this.textSubject.next(e);\n  }\n\n  // Method to construct the html string from an input text array without locations\n  constructLocally() {\n    // const regularTextClass = this.regularClass ? this.regularClass : 'regTxt';\n    const beginning = '<span class=\"' + this.regularClass + '\">';\n    const analysisOutput = localAnalysis(this.targetItems, this.tempString, this.caseSensitive);\n    this.textHTMLstring = beginning + analysisOutput + ' </span>';\n  }\n\n  // Method to construct the html string from an input text array with locations\n  constructExternally() {\n    const beginning = '<span class=\"' + this.regularClass + '\">';\n    let locationChecker = true\n    const erroredItems = []\n    for (const item of this.targetItems) {\n      if (!item.location) {\n        erroredItems.push(item)\n        locationChecker = false\n      }\n    }\n    if (locationChecker) {\n      const analysisOutput = makeString(this.targetItems, this.tempString)\n      this.textHTMLstring = beginning + analysisOutput + ' </span>'\n    } else {\n      let erroredItemsText = ''\n      for (const item of erroredItems) {\n        erroredItemsText = erroredItemsText + item.text + '  '\n      }\n      this.textHTMLstring =\n        'An error occured.  The following items did not have a valid identified index location: ' + erroredItemsText\n        + 'Either provide proper index locations of each item to be highlighted or set localAnalysis to true.'\n    }\n\n  }\n\n\n\n  // ACCESSIBILITY\n  // Method to direct the focus of any click to the desired location\n  focusInput() {\n    console.log('focus');\n    if (this.lastInput) {\n      this.lastInput.nativeElement.focus();\n      this.placeCaretAtEnd(this.lastInput.nativeElement);\n    }\n  }\n\n  // Method to place the caret focus at the end of the last item of the text array\n  placeCaretAtEnd(el) {\n    el.focus()\n    if (typeof window.getSelection !== 'undefined'\n      && typeof document.createRange !== 'undefined') {\n      const range = document.createRange()\n      range.selectNodeContents(el)\n      range.collapse(false)\n      const sel = window.getSelection()\n      sel.removeAllRanges()\n      sel.addRange(range)\n    }\n  }\n\n  selectAll() {\n    document.execCommand('selectAll', false, null)\n  }\n}\n\n\nfunction localAnalysis(searchTargets, str, caseSensitive) {\n  if (caseSensitive) {\n    str = str.toLowerCase()\n    for (const item of searchTargets) {\n      item.text = item.text.toLowerCase()\n    }\n  }\n  const output = []\n  for (const item of searchTargets) {\n    let startIndex = 0\n    let index\n    const searchStrLen = item.text.length;\n    if (searchStrLen === 0) {\n        return 'An error occurred. There appears to be no input search string.'\n    }\n    while ((index = str.indexOf(item.text, startIndex)) > -1) {\n      let indexItem = {\n        text: item.text,\n        location: [index, index + searchStrLen],\n        css: item.css\n      }\n      output.push(indexItem)\n      startIndex = index + searchStrLen;\n    }\n  }\n  // console.log(output.length)\n  if (output.length === 0) {\n    console.log(\"nothing\")\n    return str\n  } else {\n    return makeString(output, str)\n  }\n  // output.sort(function(a, b) {\n  //   return a.location[0] - b.location[0]\n  // })\n}\n\nfunction makeString(searchResults, original_text) {\n  searchResults.sort(function(a, b) {\n    return a.location[0] - b.location[0]\n  })\n  let finalText = ''\n  let start = 0\n  let end = searchResults[0].location[0]\n  let middle = ''\n  for (let i = 0; i < searchResults.length; i++) {\n    if (start === 0) {\n      finalText = finalText + original_text.substring(start, end) +\n                  '<span class=\"' + searchResults[i].css + '\">' + searchResults[i].text + '</span>'\n      end = searchResults[i].location[1]\n    } else {\n      finalText = finalText + '<span class=\"' + searchResults[i].css + '\">' + searchResults[i].text + '</span>'\n    }\n\n    if (searchResults[i + 1]) {\n      middle = original_text.substring(searchResults[i].location[1], searchResults[i + 1].location[0])\n      finalText = finalText + middle\n      start = searchResults[i + 1].location[0]\n      end = searchResults[i + 1].location[1]\n    }\n\n    if (i === (searchResults.length - 1)) {\n      finalText = finalText + original_text.substring(end, original_text.length)\n    }\n  }\n  console.log(finalText)\n  return finalText\n}\n","import { NgModule } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { NgInputHighlighterComponent } from './ng-input-highlighter.component';\n\n@NgModule({\n  imports: [\n    BrowserModule\n  ],\n  declarations: [NgInputHighlighterComponent],\n  exports: [NgInputHighlighterComponent]\n})\nexport class NgInputHighlighterModule { }\n"],"names":[],"mappings":"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"}
