!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/material/menu"),require("@angular/material/select"),require("@angular/material/form-field")):"function"==typeof define&&define.amd?define("ng-input-highlighter",["exports","@angular/core","rxjs","rxjs/operators","@angular/platform-browser","@angular/material/menu","@angular/material/select","@angular/material/form-field"],t):t(e["ng-input-highlighter"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.platformBrowser,e.ng.material.menu,e.ng.material.select,e.ng.material["form-field"])}(this,function(e,n,o,t,i,r,l,a){"use strict";function S(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}var k=function(){function e(){this.type="None",this.confidence=null}return e.decorators=[{type:n.Component,args:[{template:'<span contenteditable style="margin-right:2px; display:inline-block; min-width:2px; min-height:14px">{{ text }}</span>'}]}],e.propDecorators={text:[{type:n.Input}],css:[{type:n.Input}],type:[{type:n.Input}],confidence:[{type:n.Input}],menu:[{type:n.Input}],data:[{type:n.Input}]},e}(),N=function(){function e(){this.type="None",this.confidence=null,this.added=!1}return e.prototype.clickedText=function(e){console.log("CLICKED:"+e+" ",this.text,this.css),console.log(this.menu)},e.prototype.changedText=function(){if(console.log("selected replacement:",this.selected),!this.added){var e={viewValue:this.text,value:this.text};this.menu.replacementOptions.push(e),this.added=!0}this.text=this.selected},e.decorators=[{type:n.Component,args:[{template:'<span *ngIf="!menu" contenteditable style="margin-right:2px;" (click)="clickedText(text)" [ngClass]="css">{{ text }}</span>\n\n<span *ngIf="menu" contenteditable style="margin-right:2px;cursor: pointer;" (click)="clickedText(text)" [ngClass]="css" [matMenuTriggerFor]="appMenu">{{ text }}</span>\n\n<mat-menu #appMenu="matMenu" style="font-size:14px;">\n                \x3c!-- <button mat-menu-item>Settings</button>\n                <button mat-menu-item>Help</button> --\x3e\n    <div *ngIf="menu" style="padding:10px">\n            <p *ngFor="let item of menu.descriptionItems" class="miniMenu">{{ item }}</p>\n            <p *ngIf="type">Identified type: {{ type }}</p>\n            <p *ngIf="confidence">Confidence: {{ confidence }}</p>\n            <mat-form-field *ngIf="menu.replacementOptions">\n                <mat-select placeholder="Potential replacements" [(value)]="selected" (selectionChange)="changedText()">\n                    <mat-option *ngFor="let option of menu.replacementOptions" [value]="option.value">{{ option.viewValue }}</mat-option>\n                </mat-select>\n            </mat-form-field>\n    </div>\n\n    \x3c!-- <span *ngFor="let item of actionBtns">\n        <button mat-menu-item (click)=""></button>\n    <span> --\x3e\n</mat-menu>'}]}],e.propDecorators={text:[{type:n.Input}],css:[{type:n.Input}],type:[{type:n.Input}],confidence:[{type:n.Input}],menu:[{type:n.Input}],data:[{type:n.Input}]},e}(),s=function(){function e(e){this.viewContainerRef=e}return e.decorators=[{type:n.Directive,args:[{selector:"[libTextHost]"}]}],e.ctorParameters=function(){return[{type:n.ViewContainerRef}]},e}(),c=function(){function e(e,t){this.componentFactoryResolver=e,this.renderer=t,this.targetItems=[],this.localAnalysis=!0,this.boxHeight="M",this.idleTime=2e3,this.fontClass="regularText",this.boxClass="none",this.boxFocus="focused",this.initFocus=!0,this.caseSensitive=!1,this.currentText=new n.EventEmitter,this.textSubject=new o.Subject,this.responsePending=!1,this.textArray=[]}return e.prototype.ngOnInit=function(){var n=this;this.textSubject.pipe(t.debounceTime(2e3)).subscribe(function(e){n.responsePending=!0;var t=n.obtainText();n.targetText.viewContainerRef.clear(),n.currentText.emit(t),n.localAnalysis&&(n.constructLocally(t),setTimeout(function(){n.responsePending=!1,n.focusInput()},500))}),"XS"===this.boxHeight?this.boxSize="xsmall":"S"===this.boxHeight?this.boxSize="small":"L"===this.boxHeight?this.boxSize="large":"XL"===this.boxHeight?this.boxSize="xlarge":this.boxSize="medium"},e.prototype.ngOnChanges=function(e){var t=this;if(0<this.targetItems.length&&!this.localAnalysis&&e.targetItems){console.log("new external target input received");var n=this.obtainText();this.targetText.viewContainerRef.clear(),this.currentText.emit(n),this.constructExternally(n),setTimeout(function(){t.responsePending=!1,t.focusInput()},500)}},e.prototype.ngAfterViewInit=function(){var e=this;this.renderer.listen(this.targetText.viewContainerRef.element.nativeElement,"focus",function(){e.renderer.addClass(e.inputBox.nativeElement,e.boxFocus)}),this.renderer.listen(this.targetText.viewContainerRef.element.nativeElement,"blur",function(){e.renderer.removeClass(e.inputBox.nativeElement,e.boxFocus)}),this.renderer.listen(this.textArea.nativeElement,"keyup",function(){console.log("keystroke"),e.textSubject.next()}),this.initFocus&&this.focusInput()},e.prototype.obtainText=function(){if(console.log("target",this.targetText),this.textArea.nativeElement.childElementCount<2){console.log("one child element",this.textArea.nativeElement.childElementCount);var e=this.textArea.nativeElement.innerText;return console.log(this.textArea),console.log("text obtained",e),e}console.log("lots of children elements",this.textArea.nativeElement.childElementCount);var t=this.textArea.nativeElement.childNodes,n="";if(console.log(this.textArea),1<this.textArea.nativeElement.childNodes.length&&("br"===this.textArea.nativeElement.childNodes[1].localName&&(console.log("br exists- killing it"),this.textArea.nativeElement.removeChild(this.textArea.nativeElement.childNodes[1])),"#text"===this.textArea.nativeElement.childNodes[1].nodeName)){console.log("clean delete- text exists in [1] exists- extracting it");var o=this.textArea.nativeElement.childNodes[1].textContent;return this.textArea.nativeElement.removeChild(this.textArea.nativeElement.childNodes[1]),"br"===this.textArea.nativeElement.childNodes[1].localName&&(console.log("a new br exists- killing it"),this.textArea.nativeElement.removeChild(this.textArea.nativeElement.childNodes[1])),console.log("text obtained",o),o}for(var i=0;i<t.length;i++)t[i].innerText&&(n=n+" "+t[i].innerText);return console.log("text obtained",n),n},e.prototype.renderComponents=function(r){var l=this;setTimeout(function(){console.log("in render",l.textArea);var e=l.targetText;l.textArea.nativeElement.firstChild.textContent="",console.log("render array",r);for(var t=0;t<r.length;t++){var n=l.componentFactoryResolver.resolveComponentFactory(r[t].component),o=e.viewContainerRef.createComponent(n),i=l.targetText.viewContainerRef.element;o.instance.text=r[t].text,o.instance.css=r[t].css,o.instance.type=r[t].type,o.instance.confidence=r[t].confidence,o.instance.menu=r[t].menu,o.instance.data=r[t],l.renderer.appendChild(i.nativeElement,o.location.nativeElement)}})},e.prototype.constructLocally=function(e){console.log("in construct locally");var t=function f(e,t,n){var o,i;console.log("in local analysis");var r=[];try{for(var l=S(e),a=l.next();!a.done;a=l.next()){var s=a.value,c=0,u=void 0,p=s.text.length;if(0===p)return"An error occurred. There appears to be no input search string.";var d=void 0,h=void 0;for(h=n?(d=t,s.text):(d=t.toLowerCase(),s.text.toLowerCase());-1<(u=d.indexOf(h,c));){var m={text:t.substring(u,u+p),location:[u,u+p],menu:s.menu?s.menu:null,type:s.type?s.type:null,confidence:null,css:s.css};r.push(m),c=u+p}}}catch(x){o={error:x}}finally{try{a&&!a.done&&(i=l["return"])&&i.call(l)}finally{if(o)throw o.error}}return console.log("output from local: ",r),g(r,t)}(this.targetItems,e,this.caseSensitive);this.renderComponents(t)},e.prototype.constructExternally=function(e){console.log("in construct externally"),g(this.targetItems,e)},e.prototype.focusInput=function(){console.log("focus"),this.textArea&&(this.textArea.nativeElement.focus(),this.placeCaretAtEnd(this.textArea.nativeElement))},e.prototype.placeCaretAtEnd=function(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}},e.prototype.selectAll=function(){document.execCommand("selectAll",!1,null)},e.decorators=[{type:n.Component,args:[{selector:"lib-ng-input-highlighter",template:'<div #inputBox id="input-area" tabindex="0" [ngClass]="[boxSize, boxClass]">\n  <div class="text-area" [ngClass]="{\'pending\': responsePending}">\n    <div libTextHost #textArea contenteditable  id="input-span" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></div>\n    <span *ngIf="responsePending"><i class="fa fa-circle-o-notch fa-spin fa-fw"></i></span>\n    <span (click)="focusInput()" (dblclick)="selectAll()" class="blank-input"> </span>\n  </div>\n  <div (click)="focusInput()" (dblclick)="selectAll()" class="rest"></div>\n</div>',styles:["#input-area{color:#000;margin-top:10px;border-radius:5px;width:100%;border:1px solid #e3ecf7;overflow:hidden;padding:10px}.none{background-color:#f3f6fa}.xsmall{height:41px}.small{height:100px}.medium{height:250px}.large{height:500px}.xlarge{height:1000px}.text-area{display:flex;flex-wrap:wrap;max-width:100%}#input-span{max-width:100%;min-width:2px}#input-span:focus{outline:transparent solid 0}.blank-input{flex:1;width:100%}.rest{flex:1;flex-direction:column;width:100%;height:90%;max-height:230px}.focused{border:1px solid #647182!important}.pending{opacity:.3;color:gray!important}#delete-this-one{font-style:italic;opacity:.7;color:#778899}"]}]}],e.ctorParameters=function(){return[{type:n.ComponentFactoryResolver},{type:n.Renderer2}]},e.propDecorators={targetItems:[{type:n.Input}],localAnalysis:[{type:n.Input}],boxHeight:[{type:n.Input}],idleTime:[{type:n.Input}],fontClass:[{type:n.Input}],boxClass:[{type:n.Input}],boxFocus:[{type:n.Input}],initFocus:[{type:n.Input}],caseSensitive:[{type:n.Input}],currentText:[{type:n.Output}],textArea:[{type:n.ViewChild,args:["textArea"]}],emptyText:[{type:n.ViewChild,args:["emptyText"]}],targetText:[{type:n.ViewChild,args:[s]}],inputBox:[{type:n.ViewChild,args:["inputBox"]}]},e}();function g(e,t){var n,o,i,r;console.log("in construct array");var l=[],a=!0,s=[];if(0===e.length){var c={text:t,css:null,menu:null,type:null,confidence:null,component:k};return l.push(c),l}try{for(var u=S(e),p=u.next();!p.done;p=u.next()){(x=p.value).location||(s.push(x),a=!1)}}catch(E){n={error:E}}finally{try{p&&!p.done&&(o=u["return"])&&o.call(u)}finally{if(n)throw n.error}}if(!a){var d="";try{for(var h=S(s),m=h.next();!m.done;m=h.next()){var x;d=d+(x=m.value).text+"  "}}catch(T){i={error:T}}finally{try{m&&!m.done&&(r=h["return"])&&r.call(h)}finally{if(i)throw i.error}}var f={text:"An error occured. The following items did not have a valid identified index location: "+d+"Either provide proper index locations of each item to be highlighted or set localAnalysis to true.",css:null,menu:null,type:null,confidence:null,component:k};return l.push(f),l}e.sort(function(e,t){return e.location[0]-t.location[0]});for(var g=0,y=e[0].location[0],v=0;v<e.length;v++){if(0===g){var b={text:t.substring(g,y),css:null,menu:null,type:null,confidence:null,component:k};l.push(b);var C={text:e[v].text,css:e[v].css,menu:e[v].menu?e[v].menu:null,type:e[v].type?e[v].type:null,confidence:null,component:N};l.push(C),y=e[v].location[1]}else{var I={text:e[v].text,css:e[v].css,menu:e[v].menu?e[v].menu:null,type:e[v].type?e[v].type:null,confidence:null,component:N};l.push(I)}if(e[v+1]){var w={text:t.substring(e[v].location[1],e[v+1].location[0]),css:null,menu:null,type:null,confidence:null,component:k};l.push(w),g=e[v+1].location[0],y=e[v+1].location[1]}if(v===e.length-1){var A={text:t.substring(y,t.length),css:null,menu:null,type:null,confidence:null,component:k};l.push(A)}}return console.log("output of array construction:",l),l}var u=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:[i.BrowserModule,r.MatMenuModule,l.MatSelectModule,a.MatFormFieldModule],declarations:[c,s,N,k],entryComponents:[N,k],exports:[c]}]}],e}();e.NgInputHighlighterComponent=c,e.NgInputHighlighterModule=u,e.ɵb=N,e.ɵc=k,e.ɵa=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-input-highlighter.umd.min.js.map